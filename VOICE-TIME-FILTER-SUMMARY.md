# Ø®Ù„Ø§ØµÙ‡ ØªØºÛŒÛŒØ±Ø§Øª: ÙÛŒÙ„ØªØ± Ø²Ù…Ø§Ù†ÛŒ Ø¯Ø³ØªÛŒØ§Ø± ØµÙˆØªÛŒ Ø±Ø§Ø¨ÛŒÙ†

## ğŸ¯ Ù‡Ø¯Ù
Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù‚Ø§Ø¨Ù„ÛŒØª ÙÛŒÙ„ØªØ± Ø²Ù…Ø§Ù†ÛŒ Ø¨Ù‡ Ø¯Ø³ØªÛŒØ§Ø± ØµÙˆØªÛŒ Ø±Ø§Ø¨ÛŒÙ† ØªØ§ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨ØªÙˆÙ†Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø±Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ§Ø±ÛŒØ® ÙÛŒÙ„ØªØ± Ú©Ù†Ù†.

---

## â° Ú©Ù„Ù…Ø§Øª Ø²Ù…Ø§Ù†ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡

| Ú©Ù„Ù…Ù‡ ÙØ§Ø±Ø³ÛŒ | Ù…Ù‚Ø¯Ø§Ø± Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ | ØªÙˆØ¶ÛŒØ­Ø§Øª |
|------------|---------------|----------|
| Ø§Ù…Ø±ÙˆØ² | `today` | ÙÙ‚Ø· Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ² |
| Ø¯ÛŒØ±ÙˆØ² | `yesterday` | ÙÙ‚Ø· Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒØ±ÙˆØ² |
| Ø§ÛŒÙ† Ù‡ÙØªÙ‡ / Ù‡ÙØªÙ‡ | `week` | Û· Ø±ÙˆØ² Ú¯Ø°Ø´ØªÙ‡ |
| Ø§ÛŒÙ† Ù…Ø§Ù‡ / Ù…Ø§Ù‡ | `month` | Û³Û° Ø±ÙˆØ² Ú¯Ø°Ø´ØªÙ‡ |
| Ø§Ù…Ø³Ø§Ù„ / Ø³Ø§Ù„ | `year` | Ø³Ø§Ù„ Ø¬Ø§Ø±ÛŒ |

---

## ğŸ“ ØªØºÛŒÛŒØ±Ø§Øª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§

### 1. `lib/voice-assistant/keywordDetector.ts`

#### ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯: `detectTimeKeywords()`
```typescript
function detectTimeKeywords(text: string): string | null {
    const normalizedText = text.toLowerCase().trim();
    
    const timeKeywords = {
        'Ø§Ù…Ø±ÙˆØ²': 'today',
        'Ø¯ÛŒØ±ÙˆØ²': 'yesterday',
        'Ø§ÛŒÙ† Ù‡ÙØªÙ‡': 'week',
        'Ù‡ÙØªÙ‡': 'week',
        'Ø§ÛŒÙ† Ù…Ø§Ù‡': 'month',
        'Ù…Ø§Ù‡': 'month',
        'Ø§Ù…Ø³Ø§Ù„': 'year',
        'Ø³Ø§Ù„': 'year'
    };
    
    for (const [persianKeyword, englishValue] of Object.entries(timeKeywords)) {
        if (normalizedText.includes(persianKeyword)) {
            return englishValue;
        }
    }
    
    return null;
}
```

#### Ø¢Ù¾Ø¯ÛŒØª ØªØ§Ø¨Ø¹ `detectKeywords()`
- ØªØ´Ø®ÛŒØµ Ú©Ù„Ù…Ø§Øª Ø²Ù…Ø§Ù†ÛŒ Ø¯Ø± Ù…ØªÙ† Ú©Ø§Ø±Ø¨Ø±
- Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ÙÛŒÙ„ØªØ± Ø²Ù…Ø§Ù†ÛŒ Ø¨Ù‡ `params` Ù‡Ø± keyword

#### Ø¢Ù¾Ø¯ÛŒØª ØªØ§Ø¨Ø¹ `executeAction()`
- Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙÛŒÙ„ØªØ± Ø²Ù…Ø§Ù†ÛŒ Ø§Ø² `params`
- Ù¾Ø§Ø³ Ø¯Ø§Ø¯Ù† ÙÛŒÙ„ØªØ± Ø²Ù…Ø§Ù†ÛŒ Ø¨Ù‡ ØªÙˆØ§Ø¨Ø¹ Ø¯ÛŒØªØ§Ø¨ÛŒØ³

#### Ø¢Ù¾Ø¯ÛŒØª ØªØ§Ø¨Ø¹ `generateDataSummary()`
- Ù†Ù…Ø§ÛŒØ´ ÙÛŒÙ„ØªØ± Ø²Ù…Ø§Ù†ÛŒ Ø¯Ø± Ø®Ù„Ø§ØµÙ‡
- Ù…Ø«Ø§Ù„: "Ø§Ù…Ø±ÙˆØ² Ûµ ÙØ¹Ø§Ù„ÛŒØª ÛŒØ§ÙØª Ø´Ø¯"

#### Ø¢Ù¾Ø¯ÛŒØª ØªØ§Ø¨Ø¹ `formatDataForAI()`
- Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ÙÛŒÙ„ØªØ± Ø²Ù…Ø§Ù†ÛŒ Ø¨Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ÛŒ Ø¨Ù‡ AI
- Ù…Ø«Ø§Ù„: "ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ (Ø§Ù…Ø±ÙˆØ²) (Ûµ Ø±Ú©ÙˆØ±Ø¯)"

---

### 2. `lib/voice-assistant/database.ts`

#### Ø¢Ù¾Ø¯ÛŒØª ØªØ§Ø¨Ø¹ `getTasks()`
```typescript
export async function getTasks(
    assignee: string | null = null, 
    tenantKey: string = 'rabin', 
    timeFilter: string | null = null  // â† Ù¾Ø§Ø±Ø§Ù…ØªØ± Ø¬Ø¯ÛŒØ¯
)
```

**ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ø²Ù…Ø§Ù†ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡:**
```sql
-- Ø§Ù…Ø±ÙˆØ²
AND DATE(a.created_at) = CURDATE()

-- Ø¯ÛŒØ±ÙˆØ²
AND DATE(a.created_at) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)

-- Ø§ÛŒÙ† Ù‡ÙØªÙ‡
AND a.created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY)

-- Ø§ÛŒÙ† Ù…Ø§Ù‡
AND a.created_at >= DATE_SUB(NOW(), INTERVAL 30 DAY)

-- Ø§Ù…Ø³Ø§Ù„
AND YEAR(a.created_at) = YEAR(NOW())
```

#### Ø¢Ù¾Ø¯ÛŒØª ØªØ§Ø¨Ø¹ `getSalesReport()`
- Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† `yesterday` Ø¨Ù‡ ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯
- Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† `year` Ø¨Ù‡ ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯
- Ø¨Ù‡Ø¨ÙˆØ¯ Ù„Ø§Ú¯â€ŒÙ‡Ø§

#### Ø¢Ù¾Ø¯ÛŒØª ØªØ§Ø¨Ø¹ `getProjects()`
```typescript
export async function getProjects(
    tenantKey: string = 'rabin', 
    timeFilter: string | null = null  // â† Ù¾Ø§Ø±Ø§Ù…ØªØ± Ø¬Ø¯ÛŒØ¯
)
```

**ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ø²Ù…Ø§Ù†ÛŒ Ù…Ø´Ø§Ø¨Ù‡ `getTasks()` Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡**

---

## ğŸ¤ Ù…Ø«Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡

### ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§

**Ù‚Ø¨Ù„:**
```
Ú©Ø§Ø±Ø¨Ø±: "ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ Ø±Ùˆ Ø¨Ú¯Ùˆ"
Ø±Ø§Ø¨ÛŒÙ†: "ÛµÛ° ÙØ¹Ø§Ù„ÛŒØª ÛŒØ§ÙØª Ø´Ø¯."
```

**Ø¨Ø¹Ø¯:**
```
Ú©Ø§Ø±Ø¨Ø±: "ÙØ¹Ø§Ù„ÛŒØª Ø§Ù…Ø±ÙˆØ² Ø±Ùˆ Ø¨Ú¯Ùˆ"
Ø±Ø§Ø¨ÛŒÙ†: "Ø§Ù…Ø±ÙˆØ² Ûµ ÙØ¹Ø§Ù„ÛŒØª ÛŒØ§ÙØª Ø´Ø¯."

Ú©Ø§Ø±Ø¨Ø±: "ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ù‡ÙØªÙ‡ Ú†ÛŒ Ø¨ÙˆØ¯ØŸ"
Ø±Ø§Ø¨ÛŒÙ†: "Ø§ÛŒÙ† Ù‡ÙØªÙ‡ Û±Û¸ ÙØ¹Ø§Ù„ÛŒØª ÛŒØ§ÙØª Ø´Ø¯."

Ú©Ø§Ø±Ø¨Ø±: "Ú¯Ø²Ø§Ø±Ø´ Ú©Ø§Ø± Ø¯ÛŒØ±ÙˆØ²"
Ø±Ø§Ø¨ÛŒÙ†: "Ø¯ÛŒØ±ÙˆØ² Û³ ÙØ¹Ø§Ù„ÛŒØª ÛŒØ§ÙØª Ø´Ø¯."
```

### ÙØ±ÙˆØ´

```
Ú©Ø§Ø±Ø¨Ø±: "ÙØ±ÙˆØ´ Ø§Ù…Ø±ÙˆØ² Ú†Ù‚Ø¯Ø± Ø¨ÙˆØ¯ØŸ"
Ø±Ø§Ø¨ÛŒÙ†: "Ø§Ù…Ø±ÙˆØ² Û¸ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¨Ù‡ Ø§Ø±Ø²Ø´ Û²ÛµÛ°,Û°Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†."

Ú©Ø§Ø±Ø¨Ø±: "ÙØ±ÙˆØ´ Ø§ÛŒÙ† Ù…Ø§Ù‡ Ú†Ø·ÙˆØ±Ù‡ØŸ"
Ø±Ø§Ø¨ÛŒÙ†: "Ø§ÛŒÙ† Ù…Ø§Ù‡ Û³Ûµ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¨Ù‡ Ø§Ø±Ø²Ø´ Û±,Û²Û°Û°,Û°Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†."

Ú©Ø§Ø±Ø¨Ø±: "Ø¯Ø±Ø¢Ù…Ø¯ Ø§ÛŒÙ† Ù‡ÙØªÙ‡"
Ø±Ø§Ø¨ÛŒÙ†: "Ø§ÛŒÙ† Ù‡ÙØªÙ‡ Û±Ûµ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¨Ù‡ Ø§Ø±Ø²Ø´ Û´ÛµÛ°,Û°Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†."
```

### Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§

```
Ú©Ø§Ø±Ø¨Ø±: "Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ² Ú†Ù†Ø¯ ØªØ§Ø³ØªØŸ"
Ø±Ø§Ø¨ÛŒÙ†: "Ø§Ù…Ø±ÙˆØ² Û³ Ù¾Ø±ÙˆÚ˜Ù‡/Ù…Ø¹Ø§Ù…Ù„Ù‡ ÛŒØ§ÙØª Ø´Ø¯."

Ú©Ø§Ø±Ø¨Ø±: "Ø¯ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ù…Ø§Ù‡ Ø±Ùˆ Ø¨Ú¯Ùˆ"
Ø±Ø§Ø¨ÛŒÙ†: "Ø§ÛŒÙ† Ù…Ø§Ù‡ Û±Û² Ù¾Ø±ÙˆÚ˜Ù‡/Ù…Ø¹Ø§Ù…Ù„Ù‡ ÛŒØ§ÙØª Ø´Ø¯."
```

---

## ğŸ” Ø¬Ø±ÛŒØ§Ù† Ú©Ø§Ø± (Workflow)

```
1. Ú©Ø§Ø±Ø¨Ø± Ù…ÛŒÚ¯Ù‡: "ÙØ¹Ø§Ù„ÛŒØª Ø§Ù…Ø±ÙˆØ² Ø±Ùˆ Ø¨Ú¯Ùˆ"
   â†“
2. detectTimeKeywords() ØªØ´Ø®ÛŒØµ Ù…ÛŒØ¯Ù‡: "Ø§Ù…Ø±ÙˆØ²" â†’ "today"
   â†“
3. detectKeywords() Ù¾ÛŒØ¯Ø§ Ù…ÛŒÚ©Ù†Ù‡: "ÙØ¹Ø§Ù„ÛŒØª" â†’ action: "getTasks"
   â†“
4. params Ù…ÛŒØ´Ù‡: ["today"]
   â†“
5. executeAction() ØµØ¯Ø§ Ù…ÛŒØ²Ù†Ù‡: getTasks(null, "rabin", "today")
   â†“
6. Query Ø§Ø¬Ø±Ø§ Ù…ÛŒØ´Ù‡: WHERE DATE(a.created_at) = CURDATE()
   â†“
7. Ù†ØªÛŒØ¬Ù‡: ÙÙ‚Ø· ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ²
   â†“
8. generateDataSummary() Ù…ÛŒØ³Ø§Ø²Ù‡: "Ø§Ù…Ø±ÙˆØ² Ûµ ÙØ¹Ø§Ù„ÛŒØª ÛŒØ§ÙØª Ø´Ø¯"
   â†“
9. AI Ù¾Ø§Ø³Ø® Ù…ÛŒØ¯Ù‡ Ø¨Ø§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙÛŒÙ„ØªØ± Ø´Ø¯Ù‡
   â†“
10. Ø±Ø§Ø¨ÛŒÙ† Ø¨Ù‡ ØµÙˆØ±Øª ØµÙˆØªÛŒ Ù¾Ø®Ø´ Ù…ÛŒÚ©Ù†Ù‡
```

---

## ğŸ“Š Ú©ÙˆØ¦Ø±ÛŒâ€ŒÙ‡Ø§ÛŒ SQL

### ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ²
```sql
SELECT a.id, a.title, a.description, a.type, a.start_time, 
       a.performed_by, a.outcome, c.name as customer_name
FROM activities a
LEFT JOIN customers c ON a.customer_id = c.id
WHERE a.tenant_key = 'rabin'
  AND DATE(a.created_at) = CURDATE()  -- â† ÙÛŒÙ„ØªØ± Ø§Ù…Ø±ÙˆØ²
ORDER BY a.created_at DESC
LIMIT 50
```

### ÙØ±ÙˆØ´ Ø§ÛŒÙ† Ù‡ÙØªÙ‡
```sql
SELECT COUNT(*) as total_deals,
       SUM(total_value) as total_amount
FROM deals 
WHERE created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY)  -- â† ÙÛŒÙ„ØªØ± Ù‡ÙØªÙ‡
  AND tenant_key = 'rabin'
GROUP BY DATE(created_at)
```

### Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ù…Ø§Ù‡
```sql
SELECT d.id, d.title as name, d.total_value, 
       c.name as customer_name
FROM deals d
LEFT JOIN customers c ON d.customer_id = c.id
WHERE d.tenant_key = 'rabin'
  AND d.created_at >= DATE_SUB(NOW(), INTERVAL 30 DAY)  -- â† ÙÛŒÙ„ØªØ± Ù…Ø§Ù‡
ORDER BY d.created_at DESC
```

---

## âœ… Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ ÙÛŒÙ„ØªØ± Ø²Ù…Ø§Ù†ÛŒ Ø¯Ø§Ø±Ù†

| Ø¨Ø®Ø´ | ÙÛŒÙ„ØªØ± Ø²Ù…Ø§Ù†ÛŒ | ØªÙˆØ¶ÛŒØ­Ø§Øª |
|-----|-------------|----------|
| âœ… ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ | Ø¯Ø§Ø±Ø¯ | `getTasks()` |
| âœ… ÙØ±ÙˆØ´ | Ø¯Ø§Ø±Ø¯ | `getSalesReport()` |
| âœ… Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ | Ø¯Ø§Ø±Ø¯ | `getProjects()` |
| âŒ Ù‡Ù…Ú©Ø§Ø±Ø§Ù† | Ù†Ø¯Ø§Ø±Ø¯ | Ù„ÛŒØ³Øª Ø«Ø§Ø¨Øª |
| âŒ Ù…Ø´ØªØ±ÛŒØ§Ù† | Ù†Ø¯Ø§Ø±Ø¯ | Ù„ÛŒØ³Øª Ø«Ø§Ø¨Øª |
| âŒ Ù…Ø­ØµÙˆÙ„Ø§Øª | Ù†Ø¯Ø§Ø±Ø¯ | Ù„ÛŒØ³Øª Ø«Ø§Ø¨Øª |

---

## ğŸ§ª ØªØ³Øª

### ØªØ³Øª Ø¯Ø³ØªÛŒ:
1. Ø¨Ø±Ùˆ Ø¨Ù‡: `https://crm.robintejarat.com/rabin/dashboard/voice-assistant`
2. Ø¨Ú¯Ùˆ: "ÙØ¹Ø§Ù„ÛŒØª Ø§Ù…Ø±ÙˆØ² Ø±Ùˆ Ø¨Ú¯Ùˆ"
3. Ú†Ú© Ú©Ù† Ú©Ù‡ ÙÙ‚Ø· ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ² Ø±Ùˆ Ù…ÛŒÚ¯Ù‡
4. Ø¨Ú¯Ùˆ: "ÙØ±ÙˆØ´ Ø§ÛŒÙ† Ù‡ÙØªÙ‡ Ú†Ù‚Ø¯Ø± Ø¨ÙˆØ¯ØŸ"
5. Ú†Ú© Ú©Ù† Ú©Ù‡ ÙÙ‚Ø· ÙØ±ÙˆØ´ Û· Ø±ÙˆØ² Ú¯Ø°Ø´ØªÙ‡ Ø±Ùˆ Ù…ÛŒÚ¯Ù‡

### Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Console:
```
ğŸ” Detecting keywords in: ÙØ¹Ø§Ù„ÛŒØª Ø§Ù…Ø±ÙˆØ² Ø±Ùˆ Ø¨Ú¯Ùˆ
â° Time keyword detected: Ø§Ù…Ø±ÙˆØ² -> today
âœ… Keyword detected: ÙØ¹Ø§Ù„ÛŒØª
â° Time filter applied: today
âš¡ Executing action: getTasks
ğŸ“‹ Fetching tasks for tenant: rabin timeFilter: today
â° Filtering activities for TODAY
âœ… Found 5 activities for tenant rabin (today)
```

---

## ğŸ¯ Ù†ØªÛŒØ¬Ù‡

Ø­Ø§Ù„Ø§ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù…ÛŒØªÙˆÙ†Ù†:
- âœ… ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ² Ø±Ùˆ Ø¨Ø¨ÛŒÙ†Ù†
- âœ… ÙØ±ÙˆØ´ Ø¯ÛŒØ±ÙˆØ² Ø±Ùˆ Ú†Ú© Ú©Ù†Ù†
- âœ… Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ù‡ÙØªÙ‡ Ø±Ùˆ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†Ù†
- âœ… Ú¯Ø²Ø§Ø±Ø´ Ø§ÛŒÙ† Ù…Ø§Ù‡ Ø±Ùˆ Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†Ù†
- âœ… Ø¢Ù…Ø§Ø± Ø§Ù…Ø³Ø§Ù„ Ø±Ùˆ Ø¨Ø¨ÛŒÙ†Ù†

Ù‡Ù…Ù‡ Ú†ÛŒ Ø¨Ø§ ÛŒÙ‡ Ø¬Ù…Ù„Ù‡ Ø³Ø§Ø¯Ù‡! ğŸ¤
