# راهنمای صفحه حاضری دانش‌آموز

## تغییرات انجام شده

### 1. صفحه جدید دانش‌آموز
**فایل:** `pages/student-attendance.tsx`

صفحه‌ای مخصوص دانش‌آموزان (roleId = 3) که شامل:
- نمایش اطلاعات و عکس دانش‌آموز
- انتخاب بازه زمانی با تقویم فارسی (تاریخ شروع و پایان)
- نمایش لیست حاضری‌های دانش‌آموز در دروس مختلف
- نمایش وضعیت حضور/غیاب برای هر درس
- نمایش ساعت حضور و ساعت درس
- آمار کلی: تعداد کل دروس و درصد حضور

### 2. API جدید
**فایل:** `pages/api/student-attendance.ts`

API محافظت شده که:
- فقط دانش‌آموزان (roleId = 3) می‌توانند به آن دسترسی داشته باشند
- حاضری‌های دانش‌آموز را در بازه زمانی مشخص از دیتابیس می‌خواند
- اطلاعات درس، ساعت حضور و وضعیت را برمی‌گرداند

### 3. تغییرات در _app.tsx
**فایل:** `pages/_app.tsx`

- دانش‌آموزان بعد از لاگین به `/student-attendance` منتقل می‌شوند
- بررسی roleId به جای role برای دقت بیشتر

### 4. تغییرات در Layout
**فایل:** `components/Layout.tsx`

- منوی دانش‌آموزان محدود شده است
- دانش‌آموزان فقط دو منو می‌بینند:
  - حاضری من
  - پروفایل

### 5. تغییرات در validate-token API
**فایل:** `pages/api/validate-token.ts`

- اضافه شدن فیلد `role` برای سازگاری با کد قدیمی

## نحوه استفاده

### برای دانش‌آموز:
1. وارد سیستم شوید با کد ملی و رمز عبور
2. به صفحه حاضری خودتان منتقل می‌شوید
3. تاریخ شروع و پایان را انتخاب کنید
4. لیست حاضری‌های خود را مشاهده کنید

### ساختار داده
API از جدول `attendance` استفاده می‌کند:
```sql
SELECT 
  a.jalali_date,
  a.checkin_time,
  a.status,
  s.name as subjectName,
  s.startTime,
  s.endTime,
  s.dayOfWeek
FROM attendance a
LEFT JOIN Subject s ON a.subjectId = s.id
WHERE a.nationalCode = ?
  AND a.jalali_date BETWEEN ? AND ?
```

## نکات مهم

1. **امنیت:** فقط دانش‌آموزان می‌توانند حاضری خود را ببینند
2. **محدودیت دسترسی:** دانش‌آموزان نمی‌توانند حاضری را تغییر دهند
3. **تقویم فارسی:** از کتابخانه `react-multi-date-picker` استفاده شده
4. **رسپانسیو:** صفحه برای موبایل و تبلت بهینه شده

## فایل‌های تغییر یافته
- ✅ `pages/student-attendance.tsx` (جدید)
- ✅ `pages/api/student-attendance.ts` (جدید)
- ✅ `pages/_app.tsx` (ویرایش شده)
- ✅ `components/Layout.tsx` (ویرایش شده)
- ✅ `pages/api/validate-token.ts` (ویرایش شده)

## تست
برای تست:
1. با یک حساب دانش‌آموز (roleId = 3) وارد شوید
2. باید به صفحه `/student-attendance` منتقل شوید
3. تاریخ شروع و پایان را انتخاب کنید
4. حاضری‌های خود را مشاهده کنید
